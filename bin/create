#!/usr/bin/env node
var nopt = require('nopt'),
	path = require('path'),
	fs = require('fs'),
	opts = nopt({
		"old": path,
		"new": path,
		"out": path,
		"blocksize": Number,
		"verify": Boolean
	});

	if( !opts.old || !opts['new'] ){
		console.log('--old [filename] --new [filename]');
		return;
	}
	var strA = fs.readFileSync(opts.old, 'utf-8'),
		strB = fs.readFileSync(opts['new'], 'utf-8'),
		patch = require('../lib/create.js')(strA, strB, opts.blocksize);
	if( opts.verify ){
		var applied = require('../lib/apply.js')(strA, patch);
		console.log('Патч ' + (applied === strA? 'хороший':'плохой'));
	}
	if( opts.out ){
		fs.writeFileSync(opts.out, JSON.stringify(patch), 'utf-8');
	}else{
		console.log(JSON.stringify(patch));
	}
