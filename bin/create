#!/usr/bin/env node
var nopt = require('nopt'),
	path = require('path'),
	fs = require('fs'),
	opts = nopt({
		"old": path,
		"new": path,
		"out": path,
		"blocksize": Number,
		"verify": Boolean
	});

	if( !opts.old || !opts['new'] ){
		console.log('--old [filename] --new [filename]\nОпционально:\n\t--out [filename] Файл, в который нужно записать патч\n'+
					'\t--blocksize [Number] Минимальный размер блока для вставки\n\t--verify Выполнить проверку патча после создания');
		return;
	}
	var strA = fs.readFileSync(opts.old, 'utf-8'),
		strB = fs.readFileSync(opts['new'], 'utf-8'),
		patch = require('../lib/create.js')(strA, strB, opts.blocksize);
	if( opts.verify ){
		var applied = require('../lib/apply.js')(strA, patch);
		var verifyStartTime = new Date();
		console.log('Патч ' + (applied === strB? 'хороший':'плохой'));
		console.log('Проверил за ' + (new Date() - verifyStartTime) + 'мс');
	}
	if( opts.out ){
		fs.writeFileSync(opts.out, JSON.stringify(patch), 'utf-8');
	}else{
		console.log(JSON.stringify(patch));
	}
